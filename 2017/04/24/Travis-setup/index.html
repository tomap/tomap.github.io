<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="I wanted to be able to publish this site using Travis instead of AppVeyor, just to try.
I found this with Google: https://github.com/jkeylu/deploy-hex"><meta name="author" content="Thomas Piart"><meta property="og:title" content="Travis CI Setup attempt"><meta property="og:site_name" content="Thomas Piart - tpî.eu"><meta property="og:type" content="article"><meta property="og:image" content="https://raw.githubusercontent.com/encharm/Font-Awesome-SVG-PNG/30dda99e/black/png/256/thumbs-down.png"><meta property="og:url" content="https://tpî.eu/2017/04/24/Travis-setup/"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@tomap"><title>Travis CI Setup attempt - Thomas Piart - tpî.eu</title><link rel="stylesheet" href="/css/style.css"></head><body class="sans-serif"><div class="w-100 bg-1 ph5-ns ph3 text-light"><nav class="db dt-l w-100 mw8 center border-box pv3"><div class="db dtc-l v-mid w-100 w-75-l tc tr-l"><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/" title="Home">Home </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/archives" title="Archives">Archives </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/resume" title="Resume">Resume</a></div></nav><div class="w-100 mw8 center dt"><div class="dtc v-mid white"><h1 class="f1-l f2-m tc tc-m tl-ns">Travis CI Setup attempt</h1></div></div><div class="relative w-100 mw8 center white dn dn-m db-ns"><i class="header-icon fa fa-thumbs-down"></i></div></div><div class="w-100 ph2 ph4-m ph5-l mv5 mv5-l"><div class="content"><div class="mw8 center"><div class="cf"><div class="fl w-100 mw7 left fw3 lh-copy pr4-ns pr0-m post-content"><div class="tags-container-vertical"><div class="tags-sub-container"><a class="fw3 ph1" href="/tags/github/">#github</a> <a class="fw3 ph1" href="/tags/travis/">#travis</a></div></div><p>I wanted to be able to publish this site using <a href="https://travis-ci.org/" target="_blank" rel="noopener">Travis</a> instead of AppVeyor, just to try.</p><p>I found this with Google: <a href="https://github.com/jkeylu/deploy-hexo-site-by-travis-ci/blob/master/_travis.yml" target="_blank" rel="noopener">https://github.com/jkeylu/deploy-hexo-site-by-travis-ci/blob/master/_travis.yml</a></p><p>I’m not pushing to GitHub pages but to a FTP so I had to slightly modify the yml following <a href="https://docs.travis-ci.com/user/deployment/custom/#FTP" target="_blank" rel="noopener">this documentation from Travis site</a>:<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">env:</span><br><span class="line">  global:</span><br><span class="line">    - &quot;FTP_USER=user&quot;</span><br><span class="line">    - &quot;FTP_PASSWORD=password&quot;</span><br><span class="line">after_success:</span><br><span class="line">    &quot;curl --ftp-create-dirs -T uploadfilename -u $FTP_USER:$FTP_PASSWORD ftp://sitename.com/directory/myfile&quot;</span><br></pre></td></tr></table></figure><p></p><p>Unfortunately, there are multiple issues with this:</p><ul><li>One, it only uploads one file, not a full folder</li><li>Two, if the upload fails, it does not break the build.</li></ul><p>To upload a full folder, I found this <a href="https://stackoverflow.com/a/14020013/383029" target="_blank" rel="noopener">on Stack Overflow</a>:<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find mydir -type f -exec curl -u xxx:psw --ftp-create-dirs -T &#123;&#125; ftp://192.168.1.158/public/demon_test/&#123;&#125; \;</span><br></pre></td></tr></table></figure><p></p><p>It is closer but I had to replace <strong>-exec</strong> parameter by piping to <strong><a href="https://www.computerhope.com/unix/xargs.htm" target="_blank" rel="noopener">xargs</a> because </strong>-exec** does not return a -1 exit code in case of failure.</p><p>For escaping data to yaml, I used <a href="https://www.json2yaml.com/" target="_blank" rel="noopener">https://www.json2yaml.com/</a></p><p>In then end, the solution of using after_success is not cool, because in my case, that I consider build is publishing the site to the ftp. So if this step fails, I want the build to fail.</p><p>With after_success, the build is still green if this step fails. See <a href="https://docs.travis-ci.com/user/customizing-the-build/#Breaking-the-Build" target="_blank" rel="noopener">https://docs.travis-ci.com/user/customizing-the-build/#Breaking-the-Build</a></p><p>I also tried that: <a href="https://stackoverflow.com/questions/3790454/in-yaml-how-do-i-break-a-string-over-multiple-lines" target="_blank" rel="noopener">https://stackoverflow.com/questions/3790454/in-yaml-how-do-i-break-a-string-over-multiple-lines</a><br>(did not worked)</p><p>So, in the end, I dropped Travis.</p><div class="tags-container-bottom"><i class="fa fa-tag pr3 text-main-color"></i><a class="fw3 ph1" href="/tags/github/">#github</a> <a class="fw3 ph1" href="/tags/travis/">#travis</a></div><div class="pt3"><i class="fa fa-share-alt pr3 text-main-color"></i>Comment on<div class="dib mh3"><a class="fw3 ph1" href="https://github.com/tomap/tpi2.eu/issues/new?labels=comment&amp;title=Travis%20CI%20Setup%20attempt&amp;body=%0A%0AUrl:%20https://tp%C3%AE.eu/2017/04/24/Travis-setup/" target="_blank" rel="noopener noreferrer"><i class="fa fa-github"></i> github</a></div><div class="dib mh3"><a class="fw3 ph1" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://tp%C3%AE.eu/2017/04/24/Travis-setup/" target="_blank" rel="noopener noreferrer"><i class="fa fa-linkedin"></i> linkedin</a></div><div class="dib mh3"><a class="fw3 ph1" href="https://twitter.com/intent/tweet?url=https://tp%C3%AE.eu/2017/04/24/Travis-setup/&amp;via=tomap" target="_blank" rel="noopener noreferrer"><i class="fa fa-twitter"></i> twitter</a></div></div></div></div></div></div></div><div class="bg-1 ph2 ph5-ns pv5"><div class="mv8"><div class="center tc"><div class="dib mh3"><a class="f3 f2-ns white glow o-70" href="https://stackoverflow.com/users/383029/tomap" target="_blank" rel="noopener noreferrer"><i class="fa fa-stack-overflow"></i></a></div><div class="dib mh3"><a class="f3 f2-ns white glow o-70" href="https://github.com/tomap/" target="_blank" rel="noopener noreferrer"><i class="fa fa-github"></i></a></div><div class="dib mh3"><a class="f3 f2-ns white glow o-70" href="https://linkedin.com/in/thomaspiart" target="_blank" rel="noopener noreferrer"><i class="fa fa-linkedin"></i></a></div><div class="dib mh3"><a class="f3 f2-ns white glow o-70" href="https://twitter.com/tomap" target="_blank" rel="noopener noreferrer"><i class="fa fa-twitter"></i></a></div></div></div></div></body></html>