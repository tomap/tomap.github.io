<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Thomas Piart - tpî.eu - Personal site"><meta name="author" content="Thomas Piart"><meta property="og:title" content="Travis CI Setup attempt"><meta property="og:description" content="Thomas Piart - tpî.eu - Personal site"><meta property="og:site_name" content="Thomas Piart - tpî.eu"><meta property="og:type" content="article"><meta property="og:image" content="https://i❤️.ws/emoji-image/👎.png"><meta property="og:url" content="https://tpî.eu/2017/04/24/Travis-setup/"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@tomap"><meta name="generator" content="Hexo"><title>Travis CI Setup attempt - #github - #travis - Thomas Piart - tpî.eu</title><link rel="stylesheet" href="/css/style.css"><link rel="alternate" href="/atom.xml" title="Thomas Piart - tpî.eu" type="application/atom+xml"><link rel="alternate" href="/rss2.xml" title="Thomas Piart - tpî.eu" type="application/rss+xml"></head><body class="sans-serif"><header class="w-100 bg-1 ph5-ns ph3 text-light"><nav class="db w-100 mw8 center border-box pv3"><div class="db v-mid w-100 tc tr-ns"><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/">Home </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/resume/">Resume</a></div></nav><div class="w-100 tc db dt-ns"><div class="dib dtc-ns w-90-ns white"><h1 class="f1-ns tc tc-ns tl-ns">Travis CI Setup attempt</h1></div><div class="dib dtc-ns w-10-ns f1 f-5-ns f-6-l mb2"><span class="ec">👎</span></div></div></header><div class="w-100 ph2 ph4-m ph5-l mv5"><div class="content"><div class="mw8 center"><div class="cf"><div class="fl w-100 mw7 left lh-copy pr4-ns pr0-m post-content"><p>I wanted to be able to publish this site using <a target="_blank" rel="noopener" href="https://travis-ci.org/">Travis</a> instead of AppVeyor, just to try.</p><p>I found this with Google: <a target="_blank" rel="noopener" href="https://github.com/jkeylu/deploy-hexo-site-by-travis-ci/blob/master/_travis.yml">https://github.com/jkeylu/deploy-hexo-site-by-travis-ci/blob/master/_travis.yml</a></p><p>I’m not pushing to GitHub pages but to a FTP so I had to slightly modify the yml following <a target="_blank" rel="noopener" href="https://docs.travis-ci.com/user/deployment/custom/#FTP">this documentation from Travis site</a>:</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">env:</span></span><br><span class="line">  <span class="attr">global:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;FTP_USER=user&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;FTP_PASSWORD=password&quot;</span></span><br><span class="line"><span class="attr">after_success:</span></span><br><span class="line">    <span class="string">&quot;curl --ftp-create-dirs -T uploadfilename -u $FTP_USER:$FTP_PASSWORD ftp://sitename.com/directory/myfile&quot;</span></span><br></pre></td></tr></table></figure><p>Unfortunately, there are multiple issues with this:</p><ul><li>One, it only uploads one file, not a full folder</li><li>Two, if the upload fails, it does not break the build.</li></ul><p>To upload a full folder, I found this <a target="_blank" rel="noopener" href="https://stackoverflow.com/a/14020013/383029">on Stack Overflow</a>:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find mydir -<span class="built_in">type</span> f -<span class="built_in">exec</span> curl -u xxx:psw --ftp-create-dirs -T &#123;&#125; ftp://192.168.1.158/public/demon_test/&#123;&#125; \;</span><br></pre></td></tr></table></figure><p>It is closer but I had to replace <strong>-exec</strong> parameter by piping to <a target="_blank" rel="noopener" href="https://www.computerhope.com/unix/xargs.htm">xargs</a> because <strong>-exec</strong> does not return a -1 exit code in case of failure.</p><p>For escaping data to yaml, I used <a target="_blank" rel="noopener" href="https://www.json2yaml.com/">https://www.json2yaml.com/</a></p><p>In then end, the solution of using after_success is not cool, because in my case, that I consider build is publishing the site to the ftp. So if this step fails, I want the build to fail.</p><p>With after_success, the build is still green if this step fails. See <a target="_blank" rel="noopener" href="https://docs.travis-ci.com/user/customizing-the-build/#Breaking-the-Build">https://docs.travis-ci.com/user/customizing-the-build/#Breaking-the-Build</a></p><p>I also tried that: <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/3790454/in-yaml-how-do-i-break-a-string-over-multiple-lines">https://stackoverflow.com/questions/3790454/in-yaml-how-do-i-break-a-string-over-multiple-lines</a><br>(did not worked)</p><p>So, in the end, I dropped Travis.</p><div class="pt3"><span class="ec pr2">🕗</span>2017-04-24</div><div class="pt3"><span class="ec ec-mono pr2">🔖</span> <a class="mr3" href="/tags/github/">#github</a> <a class="mr3" href="/tags/travis/">#travis</a></div><div class="pt3 comment"><span class="ec ec-mono pr2">💬</span><span class="mr2">Comment on</span> <a class="mr3 ic ic-share ic-github" href="https://github.com/tomap/tpi2.eu/issues/new?labels=comment&amp;title=Travis%20CI%20Setup%20attempt&amp;body=%0A%0AUrl:%20https://tp%C3%AE.eu/2017/04/24/Travis-setup/" target="_blank" rel="noopener noreferrer">github </a><a class="mr3 ic ic-share ic-linkedin" href="https://www.linkedin.com/sharing/share-offsite/?url=https://tp%C3%AE.eu/2017/04/24/Travis-setup/" target="_blank" rel="noopener noreferrer">linkedin </a><a class="mr3 ic ic-share ic-twitter" href="https://twitter.com/intent/tweet?url=https://tp%C3%AE.eu/2017/04/24/Travis-setup/&amp;via=tomap" target="_blank" rel="noopener noreferrer">twitter</a></div></div></div></div></div></div><footer class="bg-1 ph2 ph5-ns pv5 center tc"><a class="dib m3 glow o-70 link black ma2" href="https://hachyderm.io/@tomap" target="_blank" rel="me noopener noreferrer"><i class="ic ic-mastodon"></i> <span class="db mt2">Mastodon</span> </a><a class="dib m3 glow o-70 link black ma2" href="https://stackoverflow.com/users/383029/tomap" target="_blank" rel="noopener noreferrer"><i class="ic ic-stackoverflow"></i> <span class="db mt2">StackOverflow</span> </a><a class="dib m3 glow o-70 link black ma2" href="https://github.com/tomap/" target="_blank" rel="noopener noreferrer"><i class="ic ic-github"></i> <span class="db mt2">GitHub</span> </a><a class="dib m3 glow o-70 link black ma2" href="https://www.linkedin.com/in/thomaspiart/" target="_blank" rel="noopener noreferrer"><i class="ic ic-linkedin"></i> <span class="db mt2">LinkedIn</span> </a><a class="dib m3 glow o-70 link black ma2" href="https://twitter.com/tomap" target="_blank" rel="noopener noreferrer"><i class="ic ic-twitter"></i> <span class="db mt2">Twitter</span> </a><a class="dib m3 glow o-70 link black ma2" href="/rss2.xml" target="_blank" rel="noopener noreferrer"><i class="ic ic-rss"></i> <span class="db mt2">Rss</span></a></footer></body></html>