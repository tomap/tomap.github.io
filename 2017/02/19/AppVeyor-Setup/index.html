<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="I just configured AppVeyor Continuous Deployment.
To do that, I went to AppVeyor, logged in, then Project and click New Project link on top, then pick"><meta name="author" content="Thomas Piart"><meta property="og:title" content="AppVeyor Setup"><meta property="og:site_name" content="Thomas Piart - tpî.eu"><meta property="og:type" content="article"><meta property="og:image" content="https://raw.githubusercontent.com/encharm/Font-Awesome-SVG-PNG/30dda99e/black/png/256/step-forward.png"><meta property="og:url" content="https://tpî.eu/2017/02/19/AppVeyor-Setup/"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@tomap"><title>AppVeyor Setup - Thomas Piart - tpî.eu</title><link rel="stylesheet" href="/css/style.css"></head><body class="sans-serif"><div class="w-100 bg-1 ph5-ns ph3 text-light"><nav class="db dt-l w-100 mw8 center border-box pv3"><div class="db dtc-l v-mid w-100 w-75-l tc tr-l"><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/" title="Home">Home </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/archives" title="Archives">Archives </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/resume" title="Resume">Resume</a></div></nav><div class="w-100 mw8 center dt"><div class="dtc v-mid white"><h1 class="f1-l f2-m tc tc-m tl-ns">AppVeyor Setup</h1></div></div><div class="relative w-100 mw8 center white dn dn-m db-ns"><i class="header-icon fa fa-step-forward"></i></div></div><div class="w-100 ph2 ph4-m ph5-l mv5 mv5-l"><div class="content"><div class="mw8 center"><div class="cf"><div class="fl w-100 mw7 left fw3 lh-copy pr4-ns pr0-m post-content"><div class="tags-container-vertical"><div class="tags-sub-container"><a class="fw3 ph1" href="/tags/appveyor/">#appveyor</a> <a class="fw3 ph1" href="/tags/github/">#github</a></div></div><p>I just configured AppVeyor Continuous Deployment.</p><p>To do that, I went to <a href="https://www.appveyor.com/" target="_blank" rel="noopener">AppVeyor</a>, <a href="https://ci.appveyor.com/projects" target="_blank" rel="noopener">logged in</a>, then <a href="https://ci.appveyor.com/projects" target="_blank" rel="noopener">Project</a> and click <a href="https://ci.appveyor.com/projects/new" target="_blank" rel="noopener">New Project link on top</a>, then pick the GitHub Repository that you want to build and deploy (<a href="https://github.com/tomap/tpi2.eu" target="_blank" rel="noopener">GitHub.com/tomap/tpi2.eu</a> in my case).</p><p>After that, in the new project, I went to settings, <a href="https://ci.appveyor.com/project/tomap/tpi2-eu/settings" target="_blank" rel="noopener">https://ci.appveyor.com/project/tomap/tpi2-eu/settings</a>, in the Build part, I choose Script and added the following:<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install</span><br><span class="line">npm -g install hexo-cli</span><br><span class="line">hexo generate</span><br></pre></td></tr></table></figure><p></p><p>that generates the site in the <strong>public</strong> folder.</p><p>Then I went to Artifact and selected the content of this folder:<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public\**\*</span><br></pre></td></tr></table></figure><p></p><p>Then I went to Deploy, choose FTP deployment. And that when issues started :(</p><p>FTP is always something messy. Active or not. FTP, SFTP or FTPS. I tried them all without success. Then start googleing and although my issue was not exactly the same, I tried the suggestion from <a href="https://help.appveyor.com/discussions/problems/3236-cant-deploy-via-ftp-because-of-error-message-450" target="_blank" rel="noopener">AppVeyor Support Forum</a> and guess what, it worked! The solution was to enable a “Beta FTP” option, … of course.</p><p>Well, at first, I wanted to use SFTP (you know, for security, …), which is supposed to be enabled on my OVH account, but it did not work. So that’s for another day.</p><p>To test the deployment, I set the FTP folder to <strong>/www/test/</strong>. Strangely, AppVeyor decided that the best folder to deploy my files was: <strong>/www/test/<strong>public</strong>/…_ instead of directly </strong>/www/test/…__ it was one folder too deep.</p><p>I googled again and found <a href="https://www.appveyor.com/docs/packaging-artifacts/#pushing-artifacts-from-scripts" target="_blank" rel="noopener">that AppVeyor documentation page that helped me</a>. So my solution was to remove the artifact and instead use a PowerShell to publish the files so that their path was <strong>index.html</strong> instead of <strong>public/index.html</strong>.</p><p>After some trial and errors (~40 of them), I end up with something working. This is all nice and great, but I don’t like having all the configuration in AppVeyor, I prefer to have it in my Git Repository, so I can reproduce it somewhere else and I can share it also :)</p><p>Here is the exported version of my configuration: <strong>AppVeyor.yml</strong><br></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">version: 1.1.&#123;build&#125;</span><br><span class="line">build_script:</span><br><span class="line">- cmd: &gt;-</span><br><span class="line">    npm install</span><br><span class="line">    npm -g install hexo-cli</span><br><span class="line">    hexo generate</span><br><span class="line">test: off</span><br><span class="line">before_deploy:</span><br><span class="line">- ps: $root = Resolve-Path .\public; [IO.Directory]::GetFiles($root.Path, &apos;*.*&apos;, &apos;AllDirectories&apos;) | % &#123; Push-AppveyorArtifact $_ -FileName $_.Substring($root.Path.Length + 1) -DeploymentName www &#125;</span><br><span class="line">deploy:</span><br><span class="line">- provider: FTP</span><br><span class="line">  host: ftp.cluster014.hosting.ovh.net</span><br><span class="line">  protocol: ftp</span><br><span class="line">  username: xntprja</span><br><span class="line">  password:</span><br><span class="line">    secure: xXShqZFpQ6Jeg8O86XJ8fiqe7AiTHWrFaS6ic4AVTtE=</span><br><span class="line">  folder: /www/test</span><br><span class="line">  artifact: www</span><br><span class="line">  active_mode: false</span><br><span class="line">  beta: true</span><br><span class="line">  debug: false</span><br></pre></td></tr></table></figure><p></p><p>It takes around 2 minutes to build (due to npm package restore and FTP upload, mainly).<br>You can see the latest logs here: <a href="https://ci.appveyor.com/project/tomap/tpi2-eu" target="_blank" rel="noopener">https://ci.appveyor.com/project/tomap/tpi2-eu</a><br>And the AppVeyor.yaml is pushed on my repo: <a href="https://github.com/tomap/tpi2.eu/blob/master/appveyor.yml" target="_blank" rel="noopener">https://github.com/tomap/tpi2.eu/blob/master/appveyor.yml</a><br>I also added an indispensable badge in my <a href="https://github.com/tomap/tpi2.eu/blob/master/Readme.md" target="_blank" rel="noopener">ReadMe</a>: <a href="https://ci.appveyor.com/project/tomap/tpi2-eu" target="_blank" rel="noopener"><img src="https://ci.appveyor.com/api/projects/status/amvptl7n6hj3j8i6?svg=true" alt="Build status"></a></p><p>EDIT:<br>It seems that when using <strong>appveyor.yml</strong> to store the configuration, AppVeyor uses a different virtual machine with a lower version of NodeJS. So, google again, and I found <a href="https://www.appveyor.com/docs/lang/nodejs-iojs/" target="_blank" rel="noopener">help in their support page again</a>, and I had to add:<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">install:</span><br><span class="line">- ps: Install-Product node &apos;&apos;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p></p><p>Which should install latest version of node (7.x) :)</p><div class="tags-container-bottom"><i class="fa fa-tag pr3 text-main-color"></i><a class="fw3 ph1" href="/tags/appveyor/">#appveyor</a> <a class="fw3 ph1" href="/tags/github/">#github</a></div><div class="pt3"><i class="fa fa-share-alt pr3 text-main-color"></i>Comment on<div class="dib mh3"><a class="fw3 ph1" href="https://github.com/tomap/tpi2.eu/issues/new?labels=comment&amp;title=AppVeyor%20Setup&amp;body=%0A%0AUrl:%20https://tp%C3%AE.eu/2017/02/19/AppVeyor-Setup/" target="_blank" rel="noopener noreferrer"><i class="fa fa-github"></i> github</a></div><div class="dib mh3"><a class="fw3 ph1" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://tp%C3%AE.eu/2017/02/19/AppVeyor-Setup/" target="_blank" rel="noopener noreferrer"><i class="fa fa-linkedin"></i> linkedin</a></div><div class="dib mh3"><a class="fw3 ph1" href="https://twitter.com/intent/tweet?url=https://tp%C3%AE.eu/2017/02/19/AppVeyor-Setup/&amp;via=tomap" target="_blank" rel="noopener noreferrer"><i class="fa fa-twitter"></i> twitter</a></div></div></div></div></div></div></div><div class="bg-1 ph2 ph5-ns pv5"><div class="mv8"><div class="center tc"><div class="dib mh3"><a class="f3 f2-ns white glow o-70" href="https://stackoverflow.com/users/383029/tomap" target="_blank" rel="noopener noreferrer"><i class="fa fa-stack-overflow"></i></a></div><div class="dib mh3"><a class="f3 f2-ns white glow o-70" href="https://github.com/tomap/" target="_blank" rel="noopener noreferrer"><i class="fa fa-github"></i></a></div><div class="dib mh3"><a class="f3 f2-ns white glow o-70" href="https://linkedin.com/in/thomaspiart" target="_blank" rel="noopener noreferrer"><i class="fa fa-linkedin"></i></a></div><div class="dib mh3"><a class="f3 f2-ns white glow o-70" href="https://twitter.com/tomap" target="_blank" rel="noopener noreferrer"><i class="fa fa-twitter"></i></a></div></div></div></div></body></html>