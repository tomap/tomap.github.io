<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Thomas Piart - tpî.eu - Personal site"><meta name="author" content="Thomas Piart"><meta property="og:title" content="AppVeyor Setup"><meta property="og:description" content="Thomas Piart - tpî.eu - Personal site"><meta property="og:site_name" content="Thomas Piart - tpî.eu"><meta property="og:type" content="article"><meta property="og:image" content="https://i❤️.ws/emoji-image/⏩.png"><meta property="og:url" content="https://tpî.eu/2017/02/19/AppVeyor-Setup/"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@tomap"><meta name="generator" content="Hexo"><title>AppVeyor Setup - #appveyor - #github - Thomas Piart - tpî.eu</title><link rel="stylesheet" href="/css/style.css"><link rel="alternate" href="/atom.xml" title="Thomas Piart - tpî.eu" type="application/atom+xml"><link rel="alternate" href="/rss2.xml" title="Thomas Piart - tpî.eu" type="application/rss+xml"></head><body class="sans-serif"><header class="w-100 bg-1 ph5-ns ph3 text-light"><nav class="db w-100 mw8 center border-box pv3"><div class="db v-mid w-100 tc tr-ns"><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/">Home </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/resume/">Resume</a></div></nav><div class="w-100 tc db dt-ns"><div class="dib dtc-ns w-90-ns white"><h1 class="f1-ns tc tc-ns tl-ns">AppVeyor Setup</h1></div><div class="dib dtc-ns w-10-ns f1 f-5-ns f-6-l mb2"><span class="ec">⏩</span></div></div></header><div class="w-100 ph2 ph4-m ph5-l mv5"><div class="content"><div class="mw8 center"><div class="cf"><div class="fl w-100 mw7 left fw3 lh-copy pr4-ns pr0-m post-content"><p>I just configured AppVeyor Continuous Deployment.</p><p>To do that, I went to <a target="_blank" href="https://www.appveyor.com/" rel="noopener external nofollow noreferrer noopener">AppVeyor</a>, <a target="_blank" href="https://ci.appveyor.com/projects" rel="noopener external nofollow noreferrer noopener">logged in</a>, then <a target="_blank" href="https://ci.appveyor.com/projects" rel="noopener external nofollow noreferrer noopener">Project</a> and click <a target="_blank" href="https://ci.appveyor.com/projects/new" rel="noopener external nofollow noreferrer noopener">New Project link on top</a>, then pick the GitHub Repository that you want to build and deploy (<a target="_blank" href="https://github.com/tomap/tpi2.eu" rel="noopener external nofollow noreferrer noopener">github.com/tomap/tpi2.eu</a> in my case).</p><p>After that, in the new project, I went to settings, <a target="_blank" href="https://ci.appveyor.com/project/tomap/tpi2-eu/settings" rel="noopener external nofollow noreferrer noopener">https://ci.appveyor.com/project/tomap/tpi2-eu/settings</a>, in the Build part, I choose Script and added the following:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install</span><br><span class="line">npm -g install hexo-cli</span><br><span class="line">hexo generate</span><br></pre></td></tr></table></figure><p>that generates the site in the <strong>public</strong> folder.</p><p>Then I went to Artifact and selected the content of this folder: <code>public\**\*</code></p><p>Then I went to Deploy, choose FTP deployment. And that when issues started :(</p><p>FTP is always something messy. Active or not. FTP, SFTP or FTPS. I tried them all without success.<br>Then start googling and although my issue was not exactly the same, I tried the suggestion from <a target="_blank" href="https://help.appveyor.com/discussions/problems/3236-cant-deploy-via-ftp-because-of-error-message-450" rel="noopener external nofollow noreferrer noopener">AppVeyor Support Forum</a> and guess what, it worked!<br>The solution was to enable a “Beta FTP” option, … of course.</p><p>Well, at first, I wanted to use SFTP (you know, for security, …), which is supposed to be enabled on my OVH account, but it did not work. So that’s for another day.</p><p>To test the deployment, I set the FTP folder to <strong>/www/test/</strong>. Strangely, AppVeyor decided that the best folder to deploy my files was: _<em>/www/test/<strong>public</strong>/…</em> instead of directly <strong>/www/test/…</strong> it was one folder too deep.</p><p>I googled again and found <a target="_blank" href="https://www.appveyor.com/docs/packaging-artifacts/#pushing-artifacts-from-scripts" rel="noopener external nofollow noreferrer noopener">that AppVeyor documentation page that helped me</a>. So my solution was to remove the artifact and instead use a PowerShell to publish the files so that their path was <strong>index.html</strong> instead of <strong>public/index.html</strong>.</p><p>After some trial and errors (~40 of them), I end up with something working. This is all nice and great, but I don’t like having all the configuration in AppVeyor, I prefer to have it in my Git Repository, so I can reproduce it somewhere else and I can share it also :)</p><p>Here is the exported version of my configuration: <strong>AppVeyor.yml</strong></p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="number">1.1</span><span class="string">.&#123;build&#125;</span></span><br><span class="line"><span class="attr">build_script:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">cmd:</span> <span class="string">&gt;-</span></span><br><span class="line"><span class="string">    npm install</span></span><br><span class="line"><span class="string">    npm -g install hexo-cli</span></span><br><span class="line"><span class="string">    hexo generate</span></span><br><span class="line"><span class="string"></span><span class="attr">test:</span> <span class="string">off</span></span><br><span class="line"><span class="attr">before_deploy:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">ps:</span> <span class="string">$root</span> <span class="string">=</span> <span class="string">Resolve-Path</span> <span class="string">.\public;</span> [<span class="string">IO.Directory</span>]<span class="string">::GetFiles($root.Path,</span> <span class="string">&#x27;*.*&#x27;</span><span class="string">,</span> <span class="string">&#x27;AllDirectories&#x27;</span><span class="string">)</span> <span class="string">|</span> <span class="string">%</span> &#123; <span class="string">Push-AppveyorArtifact</span> <span class="string">$_</span> <span class="string">-FileName</span> <span class="string">$_.Substring($root.Path.Length</span> <span class="string">+</span> <span class="number">1</span><span class="string">)</span> <span class="string">-DeploymentName</span> <span class="string">www</span> &#125;</span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">provider:</span> <span class="string">FTP</span></span><br><span class="line">  <span class="attr">host:</span> <span class="string">ftp.cluster014.hosting.ovh.net</span></span><br><span class="line">  <span class="attr">protocol:</span> <span class="string">ftp</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">xntprja</span></span><br><span class="line">  <span class="attr">password:</span></span><br><span class="line">    <span class="attr">secure:</span> <span class="string">xXShqZFpQ6Jeg8O86XJ8fiqe7AiTHWrFaS6ic4AVTtE=</span></span><br><span class="line">  <span class="attr">folder:</span> <span class="string">/www/test</span></span><br><span class="line">  <span class="attr">artifact:</span> <span class="string">www</span></span><br><span class="line">  <span class="attr">active_mode:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">beta:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">debug:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>It takes around 2 minutes to build (due to npm package restore and FTP upload, mainly).<br>You can see the latest logs here: <a target="_blank" href="https://ci.appveyor.com/project/tomap/tpi2-eu" rel="noopener external nofollow noreferrer noopener">https://ci.appveyor.com/project/tomap/tpi2-eu</a><br>And the AppVeyor.yaml is pushed on my repo: <a target="_blank" href="https://github.com/tomap/tpi2.eu/blob/b4a196bef3b788a73d44cbdfb45405dc10dc5c63/appveyor.yml" rel="noopener external nofollow noreferrer noopener">https://github.com/tomap/tpi2.eu/blob/master/appveyor.yml</a><br>I also added an indispensable badge in my <a target="_blank" href="https://github.com/tomap/tpi2.eu/blob/master/Readme.md" rel="noopener external nofollow noreferrer noopener">ReadMe</a>: <a target="_blank" href="https://ci.appveyor.com/project/tomap/tpi2-eu" rel="noopener external nofollow noreferrer noopener"><img src="https://ci.appveyor.com/api/projects/status/amvptl7n6hj3j8i6?svg=true" alt="Build status"></a></p><p>EDIT:<br>It seems that when using <strong>appveyor.yml</strong> to store the configuration, AppVeyor uses a different virtual machine with a lower version of NodeJS. So, google again, and I found <a target="_blank" href="https://www.appveyor.com/docs/lang/nodejs-iojs/" rel="noopener external nofollow noreferrer noopener">help in their support page again</a>, and I had to add:</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">...</span></span><br><span class="line"><span class="attr">install:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">ps:</span> <span class="string">Install-Product</span> <span class="string">node</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><p>Which should install latest version of node (7.x) :)</p><div class="pt3"><span class="ec pr2">🕗</span>2017-02-19</div><div class="pt3"><span class="ec ec-mono pr2">🔖</span> <a class="mr3" href="/tags/appveyor/">#appveyor</a> <a class="mr3" href="/tags/github/">#github</a></div><div class="pt3 comment"><span class="ec ec-mono pr2">💬</span><span class="mr2">Comment on</span> <a class="mr3 ic ic-share ic-github" href="https://github.com/tomap/tpi2.eu/issues/new?labels=comment&amp;title=AppVeyor%20Setup&amp;body=%0A%0AUrl:%20https://tp%C3%AE.eu/2017/02/19/AppVeyor-Setup/" target="_blank" rel="noopener noreferrer">github </a><a class="mr3 ic ic-share ic-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://tp%C3%AE.eu/2017/02/19/AppVeyor-Setup/" target="_blank" rel="noopener noreferrer">linkedin </a><a class="mr3 ic ic-share ic-twitter" href="https://twitter.com/intent/tweet?url=https://tp%C3%AE.eu/2017/02/19/AppVeyor-Setup/&amp;via=tomap" target="_blank" rel="noopener noreferrer">twitter</a></div></div></div></div></div></div><footer class="bg-1 ph2 ph5-ns pv5 center tc"><a class="dib mh3 glow o-70 link black" href="https://stackoverflow.com/users/383029/tomap" target="_blank" rel="noopener noreferrer"><i class="ic ic-stackoverflow"></i> <span class="db mt2">StackOverflow</span> </a><a class="dib mh3 glow o-70 link black" href="https://github.com/tomap/" target="_blank" rel="noopener noreferrer"><i class="ic ic-github"></i> <span class="db mt2">GitHub</span> </a><a class="dib mh3 glow o-70 link black" href="https://www.linkedin.com/in/thomaspiart/" target="_blank" rel="noopener noreferrer"><i class="ic ic-linkedin"></i> <span class="db mt2">LinkedIn</span> </a><a class="dib mh3 glow o-70 link black" href="https://twitter.com/tomap" target="_blank" rel="noopener noreferrer"><i class="ic ic-twitter"></i> <span class="db mt2">Twitter</span> </a><a class="dib mh3 glow o-70 link black" href="/rss2.xml" target="_blank" rel="noopener noreferrer"><i class="ic ic-rss"></i> <span class="db mt2">Rss</span></a></footer></body></html>